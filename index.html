<!DOCTYPE html>
<html lang="en-US">
<head>
	<title>MCEdit Unified</title>
	<meta charset="utf-8">
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>

	<script src="js/marked.js"></script>

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/stylesheet.css">
	<link rel="shortcut icon" href="favicon.ico">

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-57749723-1', 'auto');
	  ga('send', 'pageview');

	</script>

	<script>
		function pageTrigger() {
			var releaseList = getJSON('https://api.github.com/repos/Khroki/MCEdit-Unified/releases');
			var commentJSON = getJSON('comments.json');
			releaseData.sort(compareVersionObject);
			for (var i = 0; i < releaseData.length; i++) {
				var note = marked(releaseData[i].body).replace(/@([a-zA-Z0-9]+)/g,' <a href="http://github.com/$1">@$1</a>');
				var version = releaseData[i].tag_name;
				var title = releaseData[i].name
				if (releaseData[i].prerelease) {
					var releaselabel = 'Pre-release';
				} else {
					var releaselabel = '';
				}
				var releasetimesec = (new Date() - new Date(releaseData[i].published_at)) / 1000;
				var releasetime = new Date(releaseData[i].published_at).toLocaleDateString();
				if (releasetimesec < 60) {
					releasetime = Math.round(releasetimesec) + 's ago';
				} else if (releasetimesec < 60 * 60) {
					releasetime = Math.round(releasetimesec / 60) + 'm ago';
				} else if (releasetimesec < 60 * 60 * 24) {
					releasetime = Math.round(releasetimesec / 60 / 60) + ' hours ago';
				} else if (releasetimesec < 60 * 60 * 24 * 30) {
					releasetime = Math.round(releasetimesec / 60 / 60 / 24) + ' days ago';
				}

				var totalDownloads = 0
				for (var x = releaseData[i].assets.length - 1; x >= 0; x--) {
					totalDownloads += releaseData[i].assets[x].download_count;
				}
				
				var commentlink = '';
				if (commentJSON.hasOwnProperty(version)) {
					commentlink = 'Comment <a href="' + commentJSON[version] + '">Here</a>';
				} else {
					commentlink = 'Comments unavailable';
				}

				$('#changelog').append('<div class="row releasenote" version="' + version + '"></div>' + (i < releaseData.length - 1 ? '<hr>' : ''));
				releasenote = $('.releasenote[version="' + version + '"]');
				releasenote.append('<div class="col-md-2 releasenote-title"><div style="padding-right:10px;"><h2 style="display:inline;"><a href="' + releaseData[i].html_url + '">' + version + '</a></h2><br>' + totalDownloads + ' downloads<br>' + commentlink + '<br>' + (releaseData[i].prerelease ? 'Pre-release<br>' : '') + releasetime + '</div></div>');
				releasenote.append('<div class="col-md-10"><p>' + note + '</p></div></div>');
			}
			$('#changelog').show();


			var latestRelease = releaseData[0];
			for (var i = 0; i < platforms.length; i++) {
                var asset3264 = getDownload(platforms[i], latestRelease.tag_name, '32.64');
				var asset32 = getDownload(platforms[i],latestRelease.tag_name, 32);
				var asset64 = getDownload(platforms[i],latestRelease.tag_name, 64);
                if(asset3264) {
                    $('#' + platforms[i] + '-downloads').append('<a class="dl btn btn-default" href="' + asset3264.browser_download_url + '"><i class="fa fa-cloud-download" ></i> Version ' + latestRelease.tag_name + ' 32/64 bit</a><br><br>');
                } else {
    				if (asset32) {
    					$('#' + platforms[i] + '-downloads').append('<a class="dl btn btn-default" href="' + asset32.browser_download_url + '"><i class="fa fa-cloud-download" ></i> Version ' + latestRelease.tag_name + ' 32bit</a><br><br>');
    				}
    				if (asset64) {
    					$('#' + platforms[i] + '-downloads').append('<a class="dl btn btn-default" href="' + asset64.browser_download_url + '"><i class="fa fa-cloud-download"></i> Version ' + latestRelease.tag_name + ' 64bit</a>');
    				}
                }
			}
		}
	</script>
	<style>
		@media (min-width: 992px) {
			.releasenote-title {
				text-align: right;
			}
		}
		@media (max-width: 991px) {
			.releasenote-title {
				text-align: center;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-12" style="padding:0xp;">
				<div class="jumbotron" style="text-align:center;" id="downloads">
					<div class="row">
						<div class="col-md-4">
							<span class="hidden-xs hidden-sm">
								<i class="fa fa-apple fa-5x"></i>
								<br><br><span style="font-size:16pt">Mac OS X</span><br><br>
							</span>
							<span class="hidden-md hidden-lg">
								<i class="fa fa-apple fa-2x"></i>
								<span style="font-size:16pt">&nbsp;Mac OS X<br></span>
							</span>
							<span id="OSX-downloads">

							</span>
						</div>
						<div class="col-md-4">
							<span class="hidden-xs hidden-sm">
								<i class="fa fa-windows fa-5x"></i>
								<br><br><span style="font-size:16pt">Windows</span><br><br>
							</span>
							<span class="hidden-md hidden-lg">
								<br><br>
								<i class="fa fa-windows fa-2x"></i>
								<span style="font-size:16pt">&nbsp;Windows<br></span>
							</span>
							<span id="Win-downloads">

							</span>
						</div>
                        <div class="col-md-4">
                            <span class="hidden-xs hidden-sm">
                                <i class="fa fa-linux fa-5x"></i>
                                <br><br><span style="font-size:16pt">Linux[Beta]</span><br><br>
                            </span>
                            <span class="hidden-md hidden-lg">
                                <br><br>
                                <i class="fa fa-linux fa-2x"></i>
                                <span style="font-size:16pt">&nbsp;Linux[Beta]<br></span>
                            </span>
                            <span id="Lin-downloads">

                            </span>
                        </div>
					</div>
					<div class="row hidden-xs hidden-sm" style="position:absolute;bottom:30px;">
						<div class="col-md-6">
							<i class="fa fa-linux"></i> Linux users can also <a href="http://github.com/Khroki/MCEdit-Unified/releases">run from source.</a>
						</div>
                        <div class="col-md-8">
                            Pre-Anvil versions can be found at the bottom of <a href="https://github.com/Khroki/mcedit-old/releases">this page.</a>
                        </div>
					</div>
					<div class="row hidden-md hidden-lg" style="position:absolute;bottom:0px;">
						<div class="col-md-6">
							<i class="fa fa-linux"></i> Linux users can also <a href="http://github.com/Khroki/MCEdit-Unified/releases">run from source.</a>
						</div>
                        <div class="col-md-6">
                            Pre-Anvil versions can be found at the bottom of <a href="https://github.com/Khroki/mcedit-old/releases">this page.</a>
                        </div>
					</div>
				</div>
			</div>
			<div id="changelog" style="display:none;">
			</div>
		</div>
	</body>
	</html>
